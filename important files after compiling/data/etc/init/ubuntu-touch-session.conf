author "Ricardo Mendoza <ricmm@ubuntu.com>"

instance $USER

stop on runlevel [016]

limit nice 40 40
oom score -10

script
    export HOME="/home/$USER"
    bashrc=$HOME/.bashrc

    uid=$(getent passwd "$USER"|cut -d: -f3)
    export XDG_RUNTIME_DIR="/run/user/$uid"

    for var in $(cat /etc/environment); do
        export $var
    done

    device=$(getprop ro.product.device)

    # defaults
    GRID_UNIT_PX=8
    QTWEBKIT_DPR=1.0

    # override defaults by sourcing /etc/ubuntu-touch-session.d/$device.conf
    [ -e /etc/ubuntu-touch-session.d/$device.conf ] && . /etc/ubuntu-touch-session.d/$device.conf

    grep -q GRID_UNIT_PX $bashrc || echo "export GRID_UNIT_PX=${GRID_UNIT_PX}" >> $bashrc
    grep -q QTWEBKIT_DPR $bashrc || echo "export QTWEBKIT_DPR=${QTWEBKIT_DPR}" >> $bashrc

    export GRID_UNIT_PX=${GRID_UNIT_PX}
    export QTWEBKIT_DPR=${QTWEBKIT_DPR}

    export DESKTOP_SESSION=ubuntu-touch

    exec su -s /bin/sh -c 'exec "$0" "$@"' $USER -- init --user
end script
